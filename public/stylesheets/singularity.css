/* ===== Theme Vars ===== */
:root {
  --bg: #0a0b10;
  --panel: #111426;
  --panel-border: #2b2e49;
  --text: #e6e6f0;
  --muted: #a5a8c2;
  --accent1: #ff6a00; /* neon orange */
  --accent2: #a000ff; /* neon purple */
  --accent3: #ff2ea6; /* magenta */
}

.wrap { background: radial-gradient(1200px 800px at 50% 40%, #14162a 0%, #0a0b10 60%, #06070b 100%); min-height: calc(100vh - 120px); border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); position: relative; overflow: hidden; }
canvas#stage { width: 100%; height: 100%; display: block; }
.hud { position: absolute; top: 16px; left: 16px; display: grid; gap: 10px; grid-template-columns: 1fr; max-width: min(420px, 90vw); z-index: 5; }
.card { background: linear-gradient(180deg, rgba(17,20,38,0.95) 0%, rgba(10,11,16,0.92) 100%); border: 1px solid var(--panel-border); border-radius: 12px; padding: 12px; color: var(--text); backdrop-filter: blur(6px); }
.title { font: 700 16px/1.2 ui-sans-serif, system-ui; letter-spacing: .02em; color: var(--text); margin: 0 0 6px 0; }
.row { display: grid; grid-template-columns: 110px 1fr 56px; gap: 8px; align-items: center; margin: 6px 0; }
.row label { color: var(--muted); font: 12px/1.2 ui-sans-serif, system-ui; }
.row input[type=range] { width: 100%; accent-color: var(--accent2); }
.row .val { font: 600 12px/1 ui-sans-serif; color: var(--accent2); text-align: right; }
.bar { height: 8px; background: linear-gradient(90deg, var(--accent1), var(--accent3), var(--accent2)); border-radius: 999px; filter: blur(0.3px); opacity: .8; }
.controls { display: grid; gap: 6px; }
.row input[type=file] { color-scheme: dark; }
.btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 8px 12px; border-radius: 10px; background: #14172e; border: 1px solid var(--panel-border); color: var(--text); cursor: pointer; font: 600 12px ui-sans-serif; }
.btn[data-on="true"] { outline: 2px solid color-mix(in oklab, var(--accent1) 60%, white 0%); background: #191d3a; color: #ffe; }
.footer { position: absolute; right: 14px; bottom: 10px; color: var(--muted); font: 12px ui-sans-serif; z-index: 5; }

/* ===== Scene Layering ===== */
html, body { height: 100%; margin: 0; background: #000; overflow: hidden; }
#stage-layer { position: fixed; inset: 0; }
#bg-stars { position: absolute; inset: 0; z-index: 0; display: block; pointer-events: none; }
#stage { position: absolute; inset: 0; z-index: 1; display: block; }

/* ===== Desktop Defaults ===== */
#controls-sheet {
  position: fixed;
  right: 24px;
  top: 24px;
  z-index: 3;
  background: rgba(8, 8, 24, 0.85);
  border: 1px solid rgba(180, 0, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  border-radius: 16px;
  backdrop-filter: blur(8px);
  color: #e8dfff;
  will-change: transform;
  width: clamp(420px, 38vw, 560px);
  max-height: min(82vh, 900px);
}
#controls-body { padding: 12px; max-height: calc(82vh - 24px); overflow: auto; }

/* FAB */
#controls-toggle {
  position: fixed; right: 16px; bottom: 16px; z-index: 4;
  width: 48px; height: 48px; border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.15);
  background: rgba(24, 0, 64, 0.9); color: #fff;
  box-shadow: 0 8px 28px rgba(0,0,0,0.45);
  display: none;
}

#controls-sheet .wrap { background: transparent; min-height: auto; border-radius: 0; box-shadow: none; position: static; overflow: visible; padding: 0; }
#controls-sheet .hud { position: static; top: auto; left: auto; max-width: none; display: grid; gap: 10px; grid-template-columns: 1fr; z-index: auto; }
#controls-sheet .card { background: linear-gradient(180deg, rgba(17,20,38,0.75) 0%, rgba(10,11,16,0.72) 100%); border-radius: 14px; padding: 12px; }
#controls-sheet .row { grid-template-columns: 120px 1fr 60px; gap: 10px; }
#controls-sheet input[type="range"], #controls-sheet select { width: 100%; }

.footer { z-index: 2; }
/* ===== Buttons: make Play big & obvious ===== */
.btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 8px 12px; border-radius: 10px; background: #14172e; border: 1px solid var(--panel-border); color: var(--text); cursor: pointer; font: 600 12px ui-sans-serif; }
.btn-primary { background: linear-gradient(90deg, var(--accent1), var(--accent3) 50%, var(--accent2)); border: 0; color: #0a0014; }
.btn-primary:focus-visible { outline: 3px solid color-mix(in oklab, var(--accent2) 55%, white 15%); outline-offset: 2px; }
.btn-play { font-size: 18px; padding: 12px 18px; border-radius: 12px; box-shadow: 0 10px 26px rgba(0,0,0,0.45); }
.btn-play:before { content: ""; width: 10px; height: 10px; border-radius: 999px; background: currentColor; opacity: 0.0; margin-right: 0; }

/* Gently pulse until the first play occurs (removed by JS when playing fires via text change) */
#play:not(:disabled):where(:not(.is-playing)) {
  animation: playPulse 1600ms ease-in-out infinite;
}
@keyframes playPulse {
  0%, 100% { transform: translateZ(0) scale(1); box-shadow: 0 0 0 0 rgba(255, 106, 0, 0.35); }
  50% { transform: translateZ(0) scale(1.02); box-shadow: 0 0 0 12px rgba(160, 0, 255, 0.10); }
}

/* Wider grid for the play row so the button isnâ€™t cramped */
.row.play-row { grid-template-columns: 1fr auto auto; gap: 10px; }
.row.play-row label { white-space: nowrap; }

/* Footer target the JS updates */
.footer { position: absolute; right: 14px; bottom: 10px; color: var(--muted); font: 12px ui-sans-serif; z-index: 5; }
.footer .now-playing { color: #e6e6f0; font-weight: 600; }

/* ===== Controls Sheet stability tweaks ===== */
#controls-sheet {
  position: fixed;
  right: 24px; top: 24px; z-index: 50; /* higher than stars and canvas */
  background: rgba(8, 8, 24, 0.85);
  border: 1px solid rgba(180, 0, 255, 0.25);
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  border-radius: 16px;
  backdrop-filter: blur(8px);
  color: #e8dfff;
  will-change: transform;
  width: clamp(420px, 38vw, 560px);
  max-height: min(82vh, 900px);
  contain: paint; /* reduce transform/layout jank on mobile rotations */
}
#controls-body { padding: 12px; max-height: calc(82vh - 24px); overflow: auto; }

/* FAB */
#controls-toggle {
  position: fixed; right: 16px; bottom: 16px; z-index: 60;
  width: 48px; height: 48px; border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.15);
  background: rgba(24, 0, 64, 0.9); color: #fff;
  box-shadow: 0 8px 28px rgba(0,0,0,0.45);
  display: none;
}

/* ===== MOBILE MODE ===== */
@media (orientation: portrait), (max-width: 1024px), (hover: none) and (pointer: coarse) {
  #controls-sheet {
    left: 0; right: 0; bottom: 0; top: auto;
    width: 100vw; max-width: 100vw;
    border-radius: 16px 16px 0 0;
    transform: translateY(76%); /* slightly more hidden so the grab area stays consistent */
    transition: transform 240ms ease;
    max-height: 78vh; /* a touch taller for long lists */
    touch-action: manipulation; /* stop weird scrolling gestures from fighting the sheet */
  }
  #controls-sheet[data-open="true"] { transform: translateY(0%); }
  #controls-body { max-height: calc(78vh - 24px); }

  #controls-toggle { display: inline-flex; align-items: center; justify-content: center; }

  .row.play-row { grid-template-columns: 1fr; }
  .btn-play { width: 100%; }
}

/* ===== iOS safe-area ===== */
@supports (padding: env(safe-area-inset-bottom)) {
  #controls-body { padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
  @media (orientation: portrait), (max-width: 1024px), (hover: none) and (pointer: coarse) {
    #controls-sheet { padding-bottom: env(safe-area-inset-bottom); }
    #controls-toggle { bottom: calc(16px + env(safe-area-inset-bottom)); }
  }
}


input[type="file"] {
  color: transparent;
  width: 0.1px; 
  height: 0.1px;
  overflow: hidden;
  position: absolute;
  z-index: -1;
}

#file-label {
  font: 600 13px ui-sans-serif, system-ui;
  color: var(--accent2);
}

#play {
  display: block;
  margin: 0 auto;
}
